{"title":"Wolfpack World Cup Predictor","markdown":{"yaml":{"title":"Wolfpack World Cup Predictor","image":"wc_logo.png","about":{"template":"trestles","image-shape":"rounded","image-width":"15em"}},"headingText":"players names","containsRefs":false,"markdown":"\n\n```{r include = FALSE}\nlibrary(readxl)\nlibrary(dplyr)\nlibrary(kableExtra)\nlibrary(rvest)\nlibrary(stringi)\nlibrary(stringr)\n\n\nnames <- c(\"Drew\", \"Bob\", \"Curran\", \"Sully\", \"Ray\", \"Shaw\", \n           \"Coady\", \"Pa\", \"Hanley\")\n\n# standings ---------------------------------------------------------------\n\nstandings <- data.frame(\"Name\" = names)  \n\n\n\n# group results -----------------------------------------------------------\n\ngroup_results <- read.csv(\"files/group-results.csv\")\n\n# scrape results ----------------------------------------------------------\n\nfixtures_results <- read.csv(\"files/fixtures-results.csv\")\n\nresults <- fixtures_results[, c(5, 6, 8, 9)]\n\nurl_result <- c(\"https://www.soccerbase.com/matches/results.sd\")\n\nresult <- read_html(url_result)\n\nscores <- result %>% \n  html_nodes(\".score\") %>%\n  html_text() \n\nteams <-  result %>% \n  html_nodes(\".team\") %>%\n  html_text() \n\nHome <- teams[seq(1, length(teams) - 1, by = 2)]\nAway <- teams[seq(2, length(teams), by = 2)]\nHome.score <- sapply(scores, \\(x) str_sub(x, start = 1, end = 1))\nAway.score <- sapply(scores, \\(x) str_sub(x, start = -1, end = -1))\n\nscraped <- data.frame(Home, Away, Home.score, Away.score)\n\nscraped$Home.score <- ifelse(scraped$Home.score == \"v\", NA, scraped$Home.score)\nscraped$Away.score <- ifelse(scraped$Away.score == \"v\", NA, scraped$Away.score)\n\nscraped$Home[scraped$Home == \"South Korea\"] <- \"Korea Republic\"\nscraped$Away[scraped$Away == \"South Korea\"] <- \"Korea Republic\"\n\nresults <- left_join(results, scraped,\n                     by = c(\"Home.Team\" = \"Home\", \"Away.Team\" = \"Away\"))\n\nresults[is.na(results$Home.Score) & is.na(results$Away.Score) &\n          !is.na(results$Home.score) & !is.na(results$Away.score), c(3, 4)] <-\n  \n  results[is.na(results$Home.Score) & is.na(results$Away.Score) &\n            !is.na(results$Home.score) & !is.na(results$Away.score), c(5, 6)]\n\nfixtures_results$Home.Score <- results$Home.Score\nfixtures_results$Away.Score <- results$Away.Score\n\nwrite.csv(fixtures_results, \"files/fixtures-results.csv\", row.names = FALSE)\n\n\n# fixtures results ---------------------------------------------------------\n\nfixtures_results <- read.csv(\"files/fixtures-results.csv\")\n\nresults <- fixtures_results[!is.na(fixtures_results$Home.Score), c(5, 6, 8, 9)]\n\nresults$Result <- ifelse(\n  results$Home.Score > results$Away.Score + 1, \"H2\",\n  ifelse(results$Home.Score + 1 < results$Away.Score, \"A2\",\n         ifelse(results$Home.Score > results$Away.Score, \"H\",\n                ifelse(results$Home.Score < results$Away.Score, \"A\",\n                       ifelse(results$Home.Score == results$Away.Score, \"D\", \n                              \"NA\")))))\n\nresults <- results[, c(1, 2, 5)]\n\n\n# group selection ----------------------------------------------\n\n\nfor (name in names) {\n  my_data <- read_excel(\"files/Wolfpack World Cup Predictor 2022.xlsm\", \n                        sheet = name, col_names = FALSE)\n  \n  \n  # group match points ------------------------------------------------------\n  \n  \n  group_selections <- my_data[, 1:8]\n  \n  remove_ind <- c(1:2, sapply(1:7, \\(x) (9 * x):((9 * x) + 2)), 72:73)\n  \n  group_selections <- group_selections[-remove_ind, ]\n  \n  group_selections[, 9] <- ifelse(\n    !is.na(group_selections[, 2]), \"H2\", \n    ifelse(!is.na(group_selections[, 3]), \"H\",\n           ifelse(!is.na(group_selections[, 4]), \"D\",\n                  ifelse(!is.na(group_selections[, 5]), \"A\",\n                         ifelse(!is.na(group_selections[, 6]), \"A2\",\n                                \"NA\"\n                         )))))\n  \n  group_selections <- group_selections[, c(1, 7, 9)]\n  \n  colnames(group_selections) <- c(colnames(results)[1:2], \"Prediction\")\n  \n  group_selections$Home.Team[group_selections$Home.Team\n                             == \"Netrherlands\"] = \"Netherlands\"\n  \n  group_selections$Home.Team[group_selections$Home.Team\n                             == \"Crotia\"] = \"Croatia\"\n  \n  group_selections$Home.Team[group_selections$Home.Team\n                             == \"IR Iran\"] = \"Iran\"\n  \n  group_selections$Home.Team[group_selections$Home.Team\n                             == \"Tunsia\"] = \"Tunisia\"\n  \n  group_selections$Home.Team[group_selections$Home.Team\n                             == \"Switzgerald\"] = \"Switzerland\"\n  \n  \n  group_selections$Away.Team[group_selections$Away.Team\n                             == \"Netrherlands\"] = \"Netherlands\"\n  \n  group_selections$Away.Team[group_selections$Away.Team\n                             == \"Crotia\"] = \"Croatia\"\n  \n  group_selections$Away.Team[group_selections$Away.Team\n                             == \"IR Iran\"] = \"Iran\"\n  \n  group_selections$Away.Team[group_selections$Away.Team\n                             == \"Tunsia\"] = \"Tunisia\"\n  \n  group_selections$Away.Team[group_selections$Away.Team\n                             == \"Switzgerald\"] = \"Switzerland\"\n  \n  df <- left_join(group_selections, results, \n                  by = c(\"Home.Team\", \"Away.Team\"))\n  \n  df$Points <- ifelse(\n    (df$Prediction == df$Result) & (df$Prediction == \"H2\" | df$Prediction == \"A2\"), 2, \n    ifelse(df$Prediction == df$Result, 1, \n           ifelse((df$Prediction == \"H\" & df$Result == \"H2\") | \n                    (df$Prediction == \"A\" & df$Result == \"A2\"), 1,\n                  ifelse((df$Prediction == \"H2\" & df$Result == \"H\") | \n                           (df$Prediction == \"A2\" & df$Result == \"A\"), 0,\n                         ifelse(df$Prediction == \"H2\" | df$Prediction == \"A2\", -1, 0\n                         )))))\n  \n  df$MP <- ifelse(df$Prediction == df$Result, 1, \n                  ifelse((df$Prediction == \"H\" & df$Result == \"H2\") | \n                           (df$Prediction == \"A\" & df$Result == \"A2\"), 1,\n                         ifelse((df$Prediction == \"H2\" & df$Result == \"H\") | \n                                  (df$Prediction == \"A2\" & df$Result == \"A\"), 1, 0\n                         )))\n  \n  df$BP <- ifelse((df$Prediction == df$Result) & \n                    (df$Prediction == \"H2\" | df$Prediction == \"A2\"), 1, 0)\n  \n  df$DP <- ifelse(!(df$Prediction == df$Result) & \n                    (df$Prediction == \"H2\" | df$Prediction == \"A2\"), -1, 0)\n  \n  assign(name, df)\n  \n  \n  \n  # group rank points -------------------------------------------------------\n  \n  group_standings <- my_data[-c(1:2, 7:11, 16:20, 25:29, 34:38, 43:47,\n                                52:56, 61:65, 70:73), 9:10]\n  colnames(group_standings) <- c(\"Position\", \"Team\")\n  group_standings$Group <- rep(c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\"),\n                               each = 4)\n  \n  group_standings$Team[group_standings$Team\n                       == \"Crotia\"] = \"Croatia\"\n  \n  group_standings$Team[group_standings$Team\n                       == \"IR Iran\"] = \"Iran\"\n  \n  group_standings$Team[group_standings$Team\n                       == \"Cost Rica\"] = \"Costa Rica\"\n  \n  colnames(group_results)[1] <- \"Result\"\n  \n  df_group <- left_join(group_standings, group_results,\n                        by = c(\"Team\", \"Group\"))\n  \n  df_group$score <- ifelse(df_group$Position == df_group$Result, 1, 0)\n  \n  df_group_points <- data.frame(Group = c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\"),\n                                Points = NA)\n  \n  df_group_points$Points <- sapply(df_group_points$Group, \\(x)  \n                                   as.numeric(sum(df_group$score[df_group$Group == x]) == 4))\n  \n  \n  # round of 16 points ------------------------------------------------------\n  \n  R16 <- my_data[c(3, 8, 13, 18, 23, 28, 33, 38), c(13, 14)]\n  \n  R16$Prediction <- ifelse(is.na(my_data[c(4, 9, 14, 19, 24, 29, 34, 39), 13]),\n                           \"Away Win\", \"Home Win\")\n  \n  R16$Game <- c(49:56)\n  R16$Stage <- rep(\"R16\", 8)\n  \n  QF <- my_data[c(5, 15, 25, 35), c(17, 18)]\n  \n  QF$Prediction <- ifelse(is.na(my_data[c(6, 16, 26, 36), 17]),\n                          \"Away Win\", \"Home Win\")\n  \n  QF$Game <- c(57:60)\n  QF$Stage <- rep(\"QF\", 4)\n  \n  \n  SF <- my_data[c(10, 30), c(21, 22)]\n  \n  SF$Prediction <- ifelse(is.na(my_data[c(11, 31), 21]),\n                          \"Away Win\", \"Home Win\")\n  \n  SF$Game <- c(61, 62)\n  SF$Stage <- rep(\"SF\", 2)\n  \n  F_TP <- my_data[c(15, 25), c(25, 26)]\n  \n  F_TP$Prediction <- ifelse(is.na(my_data[c(16, 26), 25]),\n                            \"Away Win\", \"Home Win\")\n  \n  F_TP$Game <- c(64, 63)\n  F_TP$Stage <- c(\"F\", \"TP\")\n  \n  colnames(R16) <- colnames(QF) <- colnames(SF) <- colnames(F_TP) <-\n    c(\"Home Team\", \"Away Team\", \"Prediction\", \"order\", \"Stage\")\n  \n  knockouts <- rbind(R16, QF, SF, F_TP)\n  \n  knockouts$`Home Team`[knockouts$`Home Team`\n                        == \"Netrherlands\"] = \"Netherlands\"\n  \n  knockouts$`Home Team`[knockouts$`Home Team`\n                        == \"Crotia\"] = \"Croatia\"\n  \n  knockouts$`Home Team`[knockouts$`Home Team`\n                        == \"IR Iran\"] = \"Iran\"\n  \n  knockouts$`Home Team`[knockouts$`Home Team`\n                        == \"Tunsia\"] = \"Tunisia\"\n  \n  knockouts$`Home Team`[knockouts$`Home Team`\n                        == \"Switzgerald\"] = \"Switzerland\"\n  \n  \n  \n  \n  knockouts$`Away Team`[knockouts$`Away Team`\n                        == \"Netrherlands\"] = \"Netherlands\"\n  \n  knockouts$`Away Team`[knockouts$`Away Team`\n                        == \"Crotia\"] = \"Croatia\"\n  \n  knockouts$`Away Team`[knockouts$`Away Team`\n                        == \"IR Iran\"] = \"Iran\"\n  \n  knockouts$`Away Team`[knockouts$`Away Team`\n                        == \"Tunsia\"] = \"Tunisia\"\n  \n  knockouts$`Away Team`[knockouts$`Away Team`\n                        == \"Switzgerald\"] = \"Switzerland\"\n  \n  \n  \n  R16$`Home Team`[R16$`Home Team`\n                  == \"Netrherlands\"] = \"Netherlands\"\n  \n  R16$`Home Team`[R16$`Home Team`\n                  == \"Crotia\"] = \"Croatia\"\n  \n  R16$`Home Team`[R16$`Home Team`\n                  == \"IR Iran\"] = \"Iran\"\n  \n  R16$`Home Team`[R16$`Home Team`\n                  == \"Tunsia\"] = \"Tunisia\"\n  \n  R16$`Home Team`[R16$`Home Team`\n                  == \"Switzgerald\"] = \"Switzerland\"\n  \n  \n  \n  \n  R16$`Away Team`[R16$`Away Team`\n                  == \"Netrherlands\"] = \"Netherlands\"\n  \n  R16$`Away Team`[R16$`Away Team`\n                  == \"Crotia\"] = \"Croatia\"\n  \n  R16$`Away Team`[R16$`Away Team`\n                  == \"IR Iran\"] = \"Iran\"\n  \n  R16$`Away Team`[R16$`Away Team`\n                  == \"Tunsia\"] = \"Tunisia\"\n  \n  R16$`Away Team`[R16$`Away Team`\n                  == \"Switzgerald\"] = \"Switzerland\"\n  \n  knockouts$Result <- NA\n  knockouts$Points <- NA\n  \n  knockouts <- knockouts[order(knockouts$order), c(1:3, 6, 4, 7)]\n  \n  R16_results <- data.frame(order = c(49:56), Result = NA)\n  R16_results$`Home Team` <- group_results$Team[c(1, 9, 5, 13, 17, 25, 21, 29)]\n  R16_results$`Away Team` <- group_results$Team[c(6, 14, 2, 10, 22, 30, 18, 26)]\n  R16_results <- left_join(R16_results, scraped,\n                           by = c(\"Home Team\" = \"Home\", \"Away Team\" = \"Away\"))\n  R16_results$Result <- ifelse(R16_results$Home.score > R16_results$Away.score,\n                               \"Home Win\", \n                               ifelse(R16_results$Home.score < R16_results$Away.score,\n                                      \"Away Win\", \"Draw\"))\n  R16_results <- R16_results[, c(3, 4, 2, 1)]\n\n  \n  \n  R16$Points <- ifelse(is.na(as.numeric(R16$`Home Team` == R16_results$`Home Team`)),\n                       0, as.numeric(R16$`Home Team` == R16_results$`Home Team`)) +\n    ifelse(is.na(as.numeric(R16$`Away Team` == R16_results$`Away Team`)),\n           0, as.numeric(R16$`Away Team` == R16_results$`Away Team`)) +\n    ifelse(is.na(as.numeric(R16$`Home Team` %in% c(R16_results$`Home Team`,\n                                                   R16_results$`Away Team`))),\n           0, as.numeric(R16$`Home Team` %in% c(R16_results$`Home Team`,\n                                                R16_results$`Away Team`))) +\n    ifelse(is.na(as.numeric(R16$`Away Team` %in% c(R16_results$`Home Team`,\n                                                   R16_results$`Away Team`))),\n           0, as.numeric(R16$`Away Team` %in% c(R16_results$`Home Team`,\n                                                R16_results$`Away Team`))) +\n    ifelse(is.na(as.numeric(R16$Prediction == R16_results$Result)), 0,\n           2*as.numeric(R16$Prediction == R16_results$Result))\n  \n  R16_points <- sum(R16$`Home Team` == R16_results$`Home Team`, na.rm = TRUE) + \n    sum(R16$`Away Team` == R16_results$`Away Team`, na.rm = TRUE) + \n    sum(R16$`Home Team` %in% c(R16_results$`Home Team`,\n                               R16_results$`Away Team`), na.rm = TRUE) + \n    sum(R16$`Away Team` %in% c(R16_results$`Home Team`,\n                               R16_results$`Away Team`), na.rm = TRUE) +\n    2*sum(R16$Prediction == R16_results$Result, na.rm = TRUE)\n  \n\n# QF Points ---------------------------------------------------------------\n\n  \n  QF_results <- data.frame(order = c(57:60), Result = NA)\n  QF_results$`Home Team` <- ifelse(R16_results$Result[c(1, 4, 5, 7)] == \"Home Win\",\n                                   R16_results$`Home Team`[c(1, 4, 5, 7)],\n                                   R16_results$`Away Team`[c(1, 4, 5, 7)])\n  \n  QF_results$`Away Team` <- ifelse(R16_results$Result[c(2, 3, 6, 8)] == \"Home Win\",\n                                   R16_results$`Home Team`[c(2, 3, 6, 8)],\n                                   R16_results$`Away Team`[c(2, 3, 6, 8)])\n  \n  QF_results <- left_join(QF_results, scraped,\n                          by = c(\"Home Team\" = \"Home\", \"Away Team\" = \"Away\"))\n  QF_results$Result <- ifelse(QF_results$Home.score > QF_results$Away.score,\n                              \"Home Win\", \n                              ifelse(QF_results$Home.score < QF_results$Away.score,\n                                     \"Away Win\", \"Draw\"))\n  QF_results <- QF_results[, c(3, 4, 2, 1)]\n  \n  \n  \n  QF$Points <- ifelse(is.na(as.numeric(QF$`Home Team` == QF_results$`Home Team`)),\n                      0, 2*as.numeric(QF$`Home Team` == QF_results$`Home Team`)) +\n    ifelse(is.na(as.numeric(QF$`Away Team` == QF_results$`Away Team`)),\n           0, 2*as.numeric(QF$`Away Team` == QF_results$`Away Team`)) +\n    ifelse(is.na(as.numeric(QF$`Home Team` %in% c(QF_results$`Home Team`,\n                                                  QF_results$`Away Team`))),\n           0, 2*as.numeric(QF$`Home Team` %in% c(QF_results$`Home Team`,\n                                                 QF_results$`Away Team`))) +\n    ifelse(is.na(as.numeric(QF$`Away Team` %in% c(QF_results$`Home Team`,\n                                                  QF_results$`Away Team`))),\n           0, 2*as.numeric(QF$`Away Team` %in% c(QF_results$`Home Team`,\n                                                 QF_results$`Away Team`))) +\n    ifelse(is.na(as.numeric(QF$Prediction == QF_results$Result)), 0,\n           4*as.numeric(QF$Prediction == QF_results$Result))\n  \n  QF_points <- 2*sum(QF$`Home Team` == QF_results$`Home Team`, na.rm = TRUE) + \n    2*sum(QF$`Away Team` == QF_results$`Away Team`, na.rm = TRUE) + \n    2*sum(QF$`Home Team` %in% c(QF_results$`Home Team`,\n                                QF_results$`Away Team`), na.rm = TRUE) + \n    2*sum(QF$`Away Team` %in% c(QF_results$`Home Team`,\n                                QF_results$`Away Team`), na.rm = TRUE) +\n    4*sum(QF$Prediction == QF_results$Result, na.rm = TRUE)\n  \n  \n  \n  # standings ---------------------------------------------------------------\n  standings$MP[standings$Name == name] <- sum(df$MP, na.rm = TRUE)\n  standings$BP[standings$Name == name] <- sum(df$BP, na.rm = TRUE)\n  standings$DP[standings$Name == name] <- sum(df$DP, na.rm = TRUE)\n  standings$GR[standings$Name == name] <- sum(df_group_points$Points,\n                                              na.rm = TRUE)\n  standings$R16[standings$Name == name] <- sum(R16$Points, na.rm = TRUE)\n  standings$QF[standings$Name == name] <- sum(QF$Points, na.rm = TRUE)\n  \n}\n\nstandings$`Total Points` <- apply(standings[, -1], 1, sum)\nstandings <- standings[order(standings$`Total Points`, decreasing = TRUE), \n]\n\n```\n\n\n\nLast updated: `r format(Sys.time())`\n\n### Table   \n\n```{r echo=FALSE}\nrow.names(standings) <- NULL\nstandings %>%\n  kbl() %>%\n  kable_styling() %>% \n  footnote(general = \"MP = Match Points; BP = Bonus Points; \n           DP = Deducted Points; GR = Group Ranking Points \\n Descriptions can be found in the Rules tab.\")\n\n```\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"index.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","page-layout":"full","theme":{"light":"flatly","dark":"darkly"},"mainfont":"Nunito","title":"Wolfpack World Cup Predictor","image":"wc_logo.png","about":{"template":"trestles","image-shape":"rounded","image-width":"15em"}},"extensions":{"book":{"multiFile":true}}}}}