{"title":"Wolfpack World Cup Predictor","markdown":{"yaml":{"title":"Wolfpack World Cup Predictor","image":"wc_logo.png","about":{"template":"trestles","image-shape":"rounded","image-width":"15em"}},"headingText":"players names","containsRefs":false,"markdown":"\n\n```{r include = FALSE}\nlibrary(readxl)\nlibrary(dplyr)\nlibrary(kableExtra)\nlibrary(rvest)\nlibrary(stringi)\nlibrary(stringr)\n\n\nnames <- c(\"Drew\", \"Bob\", \"Curran\", \"Sully\", \"Ray\", \"Shaw\", \n           \"Coady\", \"Pa\", \"Hanley\")\n\n# standings ---------------------------------------------------------------\n\nstandings <- data.frame(\"Name\" = names)  \n\n\n\n# group results -----------------------------------------------------------\n\ngroup_results <- read.csv(\"files/group-results.csv\")\n\n# scrape results ----------------------------------------------------------\n\nfixtures_results <- read.csv(\"files/fixtures-results.csv\")\n\nresults <- fixtures_results[, c(5, 6, 8, 9)]\n\nurl_result <- c(\"https://www.soccerbase.com/matches/results.sd\")\n\nresult <- read_html(url_result)\n\nscores <- result %>% \n  html_nodes(\".score\") %>%\n  html_text() \n\nteams <-  result %>% \n  html_nodes(\".team\") %>%\n  html_text() \n\nHome <- teams[seq(1, length(teams) - 1, by = 2)]\nAway <- teams[seq(2, length(teams), by = 2)]\nHome.score <- sapply(scores, \\(x) str_sub(x, start = 1, end = 1))\nAway.score <- sapply(scores, \\(x) str_sub(x, start = -1, end = -1))\n\nscraped <- data.frame(Home, Away, Home.score, Away.score)\n\nscraped$Home.score <- ifelse(scraped$Home.score == \"v\", NA, scraped$Home.score)\nscraped$Away.score <- ifelse(scraped$Away.score == \"v\", NA, scraped$Away.score)\n\nresults <- left_join(results, scraped,\n                     by = c(\"Home.Team\" = \"Home\", \"Away.Team\" = \"Away\"))\n\nresults[is.na(results$Home.Score) & is.na(results$Away.Score) &\n          !is.na(results$Home.score) & !is.na(results$Away.score), c(3, 4)] <-\n  \n  results[is.na(results$Home.Score) & is.na(results$Away.Score) &\n            !is.na(results$Home.score) & !is.na(results$Away.score), c(5, 6)]\n\nfixtures_results$Home.Score <- results$Home.Score\nfixtures_results$Away.Score <- results$Away.Score\n\nwrite.csv(fixtures_results, \"files/fixtures-results.csv\", row.names = FALSE)\n\n\n# fixtures results ---------------------------------------------------------\n\nfixtures_results <- read.csv(\"files/fixtures-results.csv\")\n\nresults <- fixtures_results[!is.na(fixtures_results$Home.Score), c(5, 6, 8, 9)]\n\nresults$Result <- ifelse(\n  results$Home.Score > results$Away.Score + 1, \"H2\",\n  ifelse(results$Home.Score + 1 < results$Away.Score, \"A2\",\n         ifelse(results$Home.Score > results$Away.Score, \"H\",\n                ifelse(results$Home.Score < results$Away.Score, \"A\",\n                       ifelse(results$Home.Score == results$Away.Score, \"D\", \n                              \"NA\")))))\n\nresults <- results[, c(1, 2, 5)]\n\n\n# group selection ----------------------------------------------\n\n\nfor (name in names) {\n  my_data <- read_excel(\"files/Wolfpack World Cup Predictor 2022.xlsm\", \n                        sheet = name, col_names = FALSE)\n  \n\n# group match points ------------------------------------------------------\n\n  \n  group_selections <- my_data[, 1:8]\n  \n  remove_ind <- c(1:2, sapply(1:7, \\(x) (9 * x):((9 * x) + 2)), 72:73)\n  \n  group_selections <- group_selections[-remove_ind, ]\n  \n  group_selections[, 9] <- ifelse(\n    !is.na(group_selections[, 2]), \"H2\", \n    ifelse(!is.na(group_selections[, 3]), \"H\",\n           ifelse(!is.na(group_selections[, 4]), \"D\",\n                  ifelse(!is.na(group_selections[, 5]), \"A\",\n                         ifelse(!is.na(group_selections[, 6]), \"A2\",\n                                \"NA\"\n                         )))))\n  \n  group_selections <- group_selections[, c(1, 7, 9)]\n  \n  colnames(group_selections) <- c(colnames(results)[1:2], \"Prediction\")\n  \n  group_selections$Home.Team[group_selections$Home.Team\n                                 == \"Netrherlands\"] = \"Netherlands\"\n  \n  group_selections$Home.Team[group_selections$Home.Team\n                                 == \"Crotia\"] = \"Croatia\"\n  \n  group_selections$Home.Team[group_selections$Home.Team\n                                 == \"IR Iran\"] = \"Iran\"\n  \n  \n  group_selections$Away.Team[group_selections$Away.Team\n                                 == \"Netrherlands\"] = \"Netherlands\"\n  \n  group_selections$Away.Team[group_selections$Away.Team\n                                 == \"Crotia\"] = \"Croatia\"\n  \n  group_selections$Away.Team[group_selections$Away.Team\n                                 == \"IR Iran\"] = \"Iran\"\n  \n  df <- left_join(group_selections, results, \n                  by = c(\"Home.Team\", \"Away.Team\"))\n  \n  df$Points <- ifelse(\n    (df$Prediction == df$Result) & (df$Prediction == \"H2\" | df$Prediction == \"A2\"), 2, \n    ifelse(df$Prediction == df$Result, 1, \n           ifelse((df$Prediction == \"H\" & df$Result == \"H2\") | \n                    (df$Prediction == \"A\" & df$Result == \"A2\"), 1,\n                  ifelse((df$Prediction == \"H2\" & df$Result == \"H\") | \n                    (df$Prediction == \"A2\" & df$Result == \"A\"), 0,\n           ifelse(df$Prediction == \"H2\" | df$Prediction == \"A2\", -1, 0\n           )))))\n  \n  assign(name, df)\n  \n  \n\n# group rank points -------------------------------------------------------\n\n  # group_standings <- my_data[-c(1:2, 7:11, 16:20, 25:29, 34:38, 43:47,\n  #                               52:56, 61:65, 70:73), 9:10]\n  # colnames(group_standings) <- c(\"Position\", \"Team\")\n  # group_standings$Group <- rep(c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\"),\n  #                              each = 4)\n  # \n  # colnames(group_results)[1] <- \"Result\" \n  # \n  # df_group <- left_join(group_standings, group_results, \n  #                       by = c(\"Team\", \"Group\"))\n  # \n  # df_group$Points <- ifelse(df_group$Position == df_group$Result, 1, 0)\n  # \n  # \n\n# standings ---------------------------------------------------------------\n  standings$GroupPoints1[standings$Name == name] <- sum(df$Points, na.rm = TRUE)\n  \n  \n  # standings$GroupPoints2[standings$Name == name] <- sum(df_group$Points,\n  #                                                    # na.rm = TRUE)\n  \n}\n\n# standings$TotalPoints <- apply(standings[, -1], 1, sum)\ncolnames(standings)[2] <- \"Total Points\"\nstandings <- standings[order(standings$`Total Points`, decreasing = TRUE), ]\n\n```\n\n\n\nLast updated: `r format(Sys.time())`\n\n### Table   \n\n```{r echo=FALSE}\nrow.names(standings) <- NULL\nstandings %>%\n  kbl() %>%\n  kable_styling()\n```\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"index.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","page-layout":"full","theme":{"light":"flatly","dark":"darkly"},"mainfont":"Nunito","title":"Wolfpack World Cup Predictor","image":"wc_logo.png","about":{"template":"trestles","image-shape":"rounded","image-width":"15em"}},"extensions":{"book":{"multiFile":true}}}}}