{"title":"Wolfpack World Cup Predictor","markdown":{"yaml":{"title":"Wolfpack World Cup Predictor","image":"wc_logo.png","about":{"template":"trestles","image-shape":"rounded","image-width":"15em"}},"headingText":"players names","containsRefs":false,"markdown":"\n\n```{r include = FALSE}\nlibrary(readxl)\nlibrary(dplyr)\nlibrary(kableExtra)\nlibrary(rvest)\nlibrary(stringi)\nlibrary(stringr)\nnames <- c(\"Drew\", \"Bob\", \"Curran\", \"Sully\", \"Ray\", \"Shaw\",\n\"Coady\", \"Pa\", \"Hanley\")\n# standings ---------------------------------------------------------------\nstandings <- data.frame(\"Name\" = names)\n# group results -----------------------------------------------------------\ngroup_results <- read.csv(\"files/group-results.csv\")\n# scrape results ----------------------------------------------------------\nfixtures_results <- read.csv(\"files/fixtures-results.csv\")\nresults <- fixtures_results[, c(5, 6, 8, 9)]\nurl_result <- c(\"https://www.soccerbase.com/matches/results.sd\")\nresult <- read_html(url_result)\nscores <- result %>%\nhtml_nodes(\".score\") %>%\nhtml_text()\nteams <-  result %>%\nhtml_nodes(\".team\") %>%\nhtml_text()\nHome <- teams[seq(1, length(teams) - 1, by = 2)]\nAway <- teams[seq(2, length(teams), by = 2)]\nHome.score <- sapply(scores, \\(x) str_sub(x, start = 1, end = 1))\nAway.score <- sapply(scores, \\(x) str_sub(x, start = -1, end = -1))\nscraped <- data.frame(Home, Away, Home.score, Away.score)\nscraped$Home.score <- ifelse(scraped$Home.score == \"v\", NA, scraped$Home.score)\nscraped$Away.score <- ifelse(scraped$Away.score == \"v\", NA, scraped$Away.score)\nscraped$Home[scraped$Home == \"South Korea\"] <- \"Korea Republic\"\nscraped$Away[scraped$Away == \"South Korea\"] <- \"Korea Republic\"\nresults <- left_join(results, scraped,\nby = c(\"Home.Team\" = \"Home\", \"Away.Team\" = \"Away\"))\nresults[is.na(results$Home.Score) & is.na(results$Away.Score) &\n!is.na(results$Home.score) & !is.na(results$Away.score), c(3, 4)] <-\nresults[is.na(results$Home.Score) & is.na(results$Away.Score) &\n!is.na(results$Home.score) & !is.na(results$Away.score), c(5, 6)]\nfixtures_results$Home.Score <- results$Home.Score\nfixtures_results$Away.Score <- results$Away.Score\nwrite.csv(fixtures_results, \"files/fixtures-results.csv\", row.names = FALSE)\n# fixtures results ---------------------------------------------------------\nfixtures_results <- read.csv(\"files/fixtures-results.csv\")\nresults <- fixtures_results[!is.na(fixtures_results$Home.Score), c(5, 6, 8, 9)]\nresults$Result <- ifelse(\nresults$Home.Score > results$Away.Score + 1, \"H2\",\nifelse(results$Home.Score + 1 < results$Away.Score, \"A2\",\nifelse(results$Home.Score > results$Away.Score, \"H\",\nifelse(results$Home.Score < results$Away.Score, \"A\",\nifelse(results$Home.Score == results$Away.Score, \"D\",\n\"NA\")))))\nresults <- results[, c(1, 2, 5)]\n# group selection ----------------------------------------------\nfor (name in names) {\nmy_data <- read_excel(\"files/Wolfpack World Cup Predictor 2022.xlsm\",\nsheet = name, col_names = FALSE)\n# group match points ------------------------------------------------------\ngroup_selections <- my_data[, 1:8]\nremove_ind <- c(1:2, sapply(1:7, \\(x) (9 * x):((9 * x) + 2)), 72:73)\ngroup_selections <- group_selections[-remove_ind, ]\ngroup_selections[, 9] <- ifelse(\n!is.na(group_selections[, 2]), \"H2\",\nifelse(!is.na(group_selections[, 3]), \"H\",\nifelse(!is.na(group_selections[, 4]), \"D\",\nifelse(!is.na(group_selections[, 5]), \"A\",\nifelse(!is.na(group_selections[, 6]), \"A2\",\n\"NA\"\n)))))\ngroup_selections <- group_selections[, c(1, 7, 9)]\ncolnames(group_selections) <- c(colnames(results)[1:2], \"Prediction\")\ngroup_selections$Home.Team[group_selections$Home.Team\n== \"Netrherlands\"] = \"Netherlands\"\ngroup_selections$Home.Team[group_selections$Home.Team\n== \"Crotia\"] = \"Croatia\"\ngroup_selections$Home.Team[group_selections$Home.Team\n== \"IR Iran\"] = \"Iran\"\ngroup_selections$Home.Team[group_selections$Home.Team\n== \"Tunsia\"] = \"Tunisia\"\ngroup_selections$Home.Team[group_selections$Home.Team\n== \"Switzgerald\"] = \"Switzerland\"\ngroup_selections$Away.Team[group_selections$Away.Team\n== \"Netrherlands\"] = \"Netherlands\"\ngroup_selections$Away.Team[group_selections$Away.Team\n== \"Crotia\"] = \"Croatia\"\ngroup_selections$Away.Team[group_selections$Away.Team\n== \"IR Iran\"] = \"Iran\"\ngroup_selections$Away.Team[group_selections$Away.Team\n== \"Tunsia\"] = \"Tunisia\"\ngroup_selections$Away.Team[group_selections$Away.Team\n== \"Switzgerald\"] = \"Switzerland\"\ndf <- left_join(group_selections, results,\nby = c(\"Home.Team\", \"Away.Team\"))\ndf$Points <- ifelse(\n(df$Prediction == df$Result) & (df$Prediction == \"H2\" | df$Prediction == \"A2\"), 2,\nifelse(df$Prediction == df$Result, 1,\nifelse((df$Prediction == \"H\" & df$Result == \"H2\") |\n(df$Prediction == \"A\" & df$Result == \"A2\"), 1,\nifelse((df$Prediction == \"H2\" & df$Result == \"H\") |\n(df$Prediction == \"A2\" & df$Result == \"A\"), 0,\nifelse(df$Prediction == \"H2\" | df$Prediction == \"A2\", -1, 0\n)))))\ndf$MP <- ifelse(df$Prediction == df$Result, 1,\nifelse((df$Prediction == \"H\" & df$Result == \"H2\") |\n(df$Prediction == \"A\" & df$Result == \"A2\"), 1,\nifelse((df$Prediction == \"H2\" & df$Result == \"H\") |\n(df$Prediction == \"A2\" & df$Result == \"A\"), 1, 0\n)))\ndf$BP <- ifelse((df$Prediction == df$Result) &\n(df$Prediction == \"H2\" | df$Prediction == \"A2\"), 1, 0)\ndf$DP <- ifelse(!(df$Prediction == df$Result) &\n(df$Prediction == \"H2\" | df$Prediction == \"A2\"), -1, 0)\nassign(name, df)\n# group rank points -------------------------------------------------------\ngroup_standings <- my_data[-c(1:2, 7:11, 16:20, 25:29, 34:38, 43:47,\n52:56, 61:65, 70:73), 9:10]\ncolnames(group_standings) <- c(\"Position\", \"Team\")\ngroup_standings$Group <- rep(c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\"),\neach = 4)\ngroup_standings$Team[group_standings$Team\n== \"Crotia\"] = \"Croatia\"\ngroup_standings$Team[group_standings$Team\n== \"IR Iran\"] = \"Iran\"\ngroup_standings$Team[group_standings$Team\n== \"Cost Rica\"] = \"Costa Rica\"\ncolnames(group_results)[1] <- \"Result\"\ndf_group <- left_join(group_standings, group_results,\nby = c(\"Team\", \"Group\"))\ndf_group$score <- ifelse(df_group$Position == df_group$Result, 1, 0)\ndf_group_points <- data.frame(Group = c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\"),\nPoints = NA)\ndf_group_points$Points <- sapply(df_group_points$Group, \\(x)\nas.numeric(sum(df_group$score[df_group$Group == x]) == 4))\n# round of 16 points ------------------------------------------------------\nR16 <- my_data[c(3, 8, 13, 18, 23, 28, 33, 38), c(13, 14)]\nR16$Prediction <- ifelse(is.na(my_data[c(4, 9, 14, 19, 24, 29, 34, 39), 13]),\n\"Away Win\", \"Home Win\")\nR16$Game <- c(49:56)\nR16$Stage <- rep(\"R16\", 8)\nQF <- my_data[c(5, 15, 25, 35), c(17, 18)]\nQF$Prediction <- ifelse(is.na(my_data[c(6, 16, 26, 36), 17]),\n\"Away Win\", \"Home Win\")\nQF$Game <- c(57:60)\nQF$Stage <- rep(\"QF\", 4)\nSF <- my_data[c(10, 30), c(21, 22)]\nSF$Prediction <- ifelse(is.na(my_data[c(11, 31), 21]),\n\"Away Win\", \"Home Win\")\nSF$Game <- c(61, 62)\nSF$Stage <- rep(\"SF\", 2)\nF_TP <- my_data[c(15, 25), c(25, 26)]\nF_TP$Prediction <- ifelse(is.na(my_data[c(16, 26), 25]),\n\"Away Win\", \"Home Win\")\nF_TP$Game <- c(64, 63)\nF_TP$Stage <- c(\"F\", \"TP\")\ncolnames(R16) <- colnames(QF) <- colnames(SF) <- colnames(F_TP) <-\nc(\"Home Team\", \"Away Team\", \"Prediction\", \"order\", \"Stage\")\nknockouts <- rbind(R16, QF, SF, F_TP)\nknockouts$`Home Team`[knockouts$`Home Team`\n== \"Netrherlands\"] = \"Netherlands\"\nknockouts$`Home Team`[knockouts$`Home Team`\n== \"Crotia\"] = \"Croatia\"\nknockouts$`Home Team`[knockouts$`Home Team`\n== \"IR Iran\"] = \"Iran\"\nknockouts$`Home Team`[knockouts$`Home Team`\n== \"Tunsia\"] = \"Tunisia\"\nknockouts$`Home Team`[knockouts$`Home Team`\n== \"Switzgerald\"] = \"Switzerland\"\nknockouts$`Away Team`[knockouts$`Away Team`\n== \"Netrherlands\"] = \"Netherlands\"\nknockouts$`Away Team`[knockouts$`Away Team`\n== \"Crotia\"] = \"Croatia\"\nknockouts$`Away Team`[knockouts$`Away Team`\n== \"IR Iran\"] = \"Iran\"\nknockouts$`Away Team`[knockouts$`Away Team`\n== \"Tunsia\"] = \"Tunisia\"\nknockouts$`Away Team`[knockouts$`Away Team`\n== \"Switzgerald\"] = \"Switzerland\"\nR16$`Home Team`[R16$`Home Team`\n== \"Netrherlands\"] = \"Netherlands\"\nR16$`Home Team`[R16$`Home Team`\n== \"Crotia\"] = \"Croatia\"\nR16$`Home Team`[R16$`Home Team`\n== \"IR Iran\"] = \"Iran\"\nR16$`Home Team`[R16$`Home Team`\n== \"Tunsia\"] = \"Tunisia\"\nR16$`Home Team`[R16$`Home Team`\n== \"Switzgerald\"] = \"Switzerland\"\nR16$`Away Team`[R16$`Away Team`\n== \"Netrherlands\"] = \"Netherlands\"\nR16$`Away Team`[R16$`Away Team`\n== \"Crotia\"] = \"Croatia\"\nR16$`Away Team`[R16$`Away Team`\n== \"IR Iran\"] = \"Iran\"\nR16$`Away Team`[R16$`Away Team`\n== \"Tunsia\"] = \"Tunisia\"\nR16$`Away Team`[R16$`Away Team`\n== \"Switzgerald\"] = \"Switzerland\"\nknockouts$Result <- NA\nknockouts$Points <- NA\nknockouts <- knockouts[order(knockouts$order), c(1:3, 6, 4, 7)]\nR16_results <- read.csv(\"files/R16_results.csv\")\nR16_results$`Home.Team` <- group_results$Team[c(1, 9, 5, 13, 17, 25, 21, 29)]\nR16_results$`Away.Team` <- group_results$Team[c(6, 14, 2, 10, 22, 30, 18, 26)]\nR16_results <- left_join(R16_results, scraped,\nby = c(\"Home.Team\" = \"Home\", \"Away.Team\" = \"Away\"))\nR16_results$Result <- ifelse(!is.na(R16_results$Result), R16_results$Result,\nifelse(R16_results$Home.score > R16_results$Away.score,\n\"Home Win\",\nifelse(R16_results$Home.score < R16_results$Away.score,\n\"Away Win\", \"Draw\")))\nR16_results <- R16_results[, c(1:4)]\nwrite.csv(R16_results, \"files/R16_results.csv\", row.names = FALSE)\nR16$Points <- ifelse(is.na(as.numeric(R16$`Home Team` == R16_results$`Home.Team`)),\n0, as.numeric(R16$`Home Team` == R16_results$`Home.Team`)) +\nifelse(is.na(as.numeric(R16$`Away Team` == R16_results$`Away.Team`)),\n0, as.numeric(R16$`Away Team` == R16_results$`Away.Team`)) +\nifelse(is.na(as.numeric(R16$`Home Team` %in% c(R16_results$`Home.Team`,\nR16_results$`Away.Team`))),\n0, as.numeric(R16$`Home Team` %in% c(R16_results$`Home.Team`,\nR16_results$`Away.Team`))) +\nifelse(is.na(as.numeric(R16$`Away Team` %in% c(R16_results$`Home.Team`,\nR16_results$`Away.Team`))),\n0, as.numeric(R16$`Away Team` %in% c(R16_results$`Home.Team`,\nR16_results$`Away.Team`))) +\nifelse(is.na(as.numeric(R16$Prediction == R16_results$Result)), 0,\n2*as.numeric(R16$Prediction == R16_results$Result))\nR16_points <- sum(R16$`Home Team` == R16_results$`Home.Team`, na.rm = TRUE) +\nsum(R16$`Away Team` == R16_results$`Away.Team`, na.rm = TRUE) +\nsum(R16$`Home Team` %in% c(R16_results$`Home.Team`,\nR16_results$`Away.Team`), na.rm = TRUE) +\nsum(R16$`Away Team` %in% c(R16_results$`Home.Team`,\nR16_results$`Away.Team`), na.rm = TRUE) +\n2*sum(R16$Prediction == R16_results$Result, na.rm = TRUE)\n# QF Points ---------------------------------------------------------------\nQF_results <- data.frame(order = c(57:60), Result = NA)\nQF_results$`Home Team` <- ifelse(R16_results$Result[c(1, 5, 3, 7)] == \"Home Win\",\nR16_results$`Home.Team`[c(1, 5, 3, 7)],\nR16_results$`Away.Team`[c(1, 5, 3, 7)])\nQF_results$`Away Team` <- ifelse(R16_results$Result[c(2, 6, 4, 8)] == \"Home Win\",\nR16_results$`Home.Team`[c(2, 6, 4, 8)],\nR16_results$`Away.Team`[c(2, 6, 4, 8)])\nQF_results <- left_join(QF_results, scraped,\nby = c(\"Home Team\" = \"Home\", \"Away Team\" = \"Away\"))\nQF_results$Result <- ifelse(QF_results$Home.score > QF_results$Away.score,\n\"Home Win\",\nifelse(QF_results$Home.score < QF_results$Away.score,\n\"Away Win\", \"Draw\"))\nQF_results <- QF_results[, c(3, 4, 2, 1)]\nQF$Points <- ifelse(is.na(as.numeric(QF$`Home Team` == QF_results$`Home Team`)),\n0, 2*as.numeric(QF$`Home Team` == QF_results$`Home Team`)) +\nifelse(is.na(as.numeric(QF$`Away Team` == QF_results$`Away Team`)),\n0, 2*as.numeric(QF$`Away Team` == QF_results$`Away Team`)) +\nifelse(is.na(as.numeric(QF$`Home Team` %in% c(QF_results$`Home Team`,\nQF_results$`Away Team`))),\n0, 2*as.numeric(QF$`Home Team` %in% c(QF_results$`Home Team`,\nQF_results$`Away Team`))) +\nifelse(is.na(as.numeric(QF$`Away Team` %in% c(QF_results$`Home Team`,\nQF_results$`Away Team`))),\n0, 2*as.numeric(QF$`Away Team` %in% c(QF_results$`Home Team`,\nQF_results$`Away Team`))) +\nifelse(is.na(as.numeric(QF$Prediction == QF_results$Result)), 0,\n4*as.numeric(QF$Prediction == QF_results$Result))\nQF_points <- 2*sum(QF$`Home Team` == QF_results$`Home Team`, na.rm = TRUE) +\n2*sum(QF$`Away Team` == QF_results$`Away Team`, na.rm = TRUE) +\n2*sum(QF$`Home Team` %in% c(QF_results$`Home Team`,\nQF_results$`Away Team`), na.rm = TRUE) +\n2*sum(QF$`Away Team` %in% c(QF_results$`Home Team`,\nQF_results$`Away Team`), na.rm = TRUE) +\n4*sum(QF$Prediction == QF_results$Result, na.rm = TRUE)\n# standings ---------------------------------------------------------------\nstandings$MP[standings$Name == name] <- sum(df$MP, na.rm = TRUE)\nstandings$BP[standings$Name == name] <- sum(df$BP, na.rm = TRUE)\nstandings$DP[standings$Name == name] <- sum(df$DP, na.rm = TRUE)\nstandings$GR[standings$Name == name] <- sum(df_group_points$Points,\nna.rm = TRUE)\nstandings$R16[standings$Name == name] <- sum(R16$Points, na.rm = TRUE)\nstandings$QF[standings$Name == name] <- sum(QF$Points, na.rm = TRUE)\n}\nstandings$`Total Points` <- apply(standings[, -1], 1, sum)\nstandings <- standings[order(standings$`Total Points`, decreasing = TRUE),]\n```\n\n\n\nLast updated: `r format(Sys.time())`\n\n### Table   \n\n```{r echo=FALSE}\nrow.names(standings) <- NULL\nstandings %>%\n  kbl() %>%\n  kable_styling() %>% \n  footnote(general = \"MP = Match Points; BP = Bonus Points; \n           DP = Deducted Points; GR = Group Ranking Points \\n Descriptions can be found in the Rules tab.\")\n\n```\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"index.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","page-layout":"full","theme":{"light":"flatly","dark":"darkly"},"mainfont":"Nunito","title":"Wolfpack World Cup Predictor","image":"wc_logo.png","about":{"template":"trestles","image-shape":"rounded","image-width":"15em"}},"extensions":{"book":{"multiFile":true}}}}}